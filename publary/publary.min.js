/**************************************************************************************************
 * 
 *  publary - a publication library include for websites based on PHP+AJAX+Bootstrap+BibTex 
 *  
 *  license and info: https://github.com/r84r/publary
 * 
 *  last modification: 2019-05-06, Ralf Bartsch
 * 
 *************************************************************************************************/
"use strict";const PUBLARY_PATH="publary/",LANGUAGE_URL_SELECTOR_EN=/\ben\.php\b$/,TRANSLATION={en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],texType:{article:"Article",inproceedings:"Conference Article",conference:"Conference Article",proceedings:"Proceedings",incollection:"Book Contribution",inbook:"Book Contribution",book:"Book",booklet:"Booklet",techreport:"Report",manual:"Manual",patent:"Patent",phdthesis:"PhD Thesis",mastersthesis:"Thesis"},issue:"Iss.",number:"No.","p.":"p.","pp.":"pp.",viewFulltextAsPdf:"Fulltext (PDF)",downloadBib:"Download citation (BibTeX)",phdtheses:"PhD Theses",abstract:"Abstract",keywords:"Keywords",switchToBriefList:"Show compact list",switchToFullList:"Show detailed list"},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],texType:{article:"Artikel",inproceedings:"Konferenzbeitrag",conference:"Konferenzbeitrag",proceedings:"Tagungsband",incollection:"Buchbeitrag",inbook:"Buchbeitrag",book:"Buch",booklet:"Heft / Broschüre",techreport:"Bericht",manual:"Dokumentation",patent:"Patent",phdthesis:"Dissertation",mastersthesis:"Abschlussarbeit"},issue:"Heft",number:"Nr.","p.":"S.","pp.":"S.",viewFulltextAsPdf:"Volltext (PDF)",downloadBib:"Zitierung herunterladen (BibTeX)",phdtheses:"Dissertationen",abstract:"Kurzfassung",keywords:"Schlüsselwörter",switchToBriefList:"Zeige weniger Infos",switchToFullList:"Zeige mehr Infos"}};function encodeURL(path){return path.split("\\").map(encodeURIComponent).join("/")}function publaryGenerateAuthorsString(authors,etAl=!0,showFirstname=!0,firstnameInitial=!0){for(var a=[],i=0;i<authors.length;i++)showFirstname?a.push(authors[i].last):a.push(authors[i].last+", "+(firstnameInitial?authors[i].first.substr(0,1)+".":authors[i].first));return a.length>2&&etAl?a[0]+" et al.":2==a.length?a.join(" & "):a.join("; ")}function publaryRefreshList(){$.get(PUBLARY_PATH+"ajax/pub-list.php"+query).done(function(queriedPubs){for(;publaryList.firstChild;)publaryList.removeChild(publaryList.firstChild);for(var i=0;i<queriedPubs.length;i++)publaryAddListItem(queriedPubs[i])})}function publaryAddListItem(pub){if(!pub)return null;var type=pub.type,key=pub["citation-key"],title=pub.title,briefItem=$(".switch-list .brief-list").hasClass("d-none"),authors=publaryGenerateAuthorsString(pub.author,briefItem,briefItem,briefItem),year="year"in pub?pub.year:"",abstract="abstract"in pub?pub.abstract:"",keywords="",journal="",links="",html,href;if(briefItem=briefItem?" d-none":"","phdthesis"==type)journal=(type=lang.texType.phdthesis)+", "+year+", "+pub.school;else if("mastersthesis"==type)journal=(type=lang.texType.thesis)+", "+year+", "+pub.school;else{if("journal"in pub?journal=pub.journal:"booktitle"in pub&&(journal=pub.booktitle),"techreport"==type&&(journal="howpublished"in pub?pub.howpublished:""),null==(type=lang.texType[type])&&(type=lang.texType.article),"volume"in pub&&(journal+=', <span class="publary-format-volissno">Vol.&nbsp;'+pub.volume+"</span>"),"issue"in pub&&(journal+=', <span class="publary-format-volissno">'+lang.issue+"&nbsp;"+pub.issue+"</span>"),"number"in pub&&(journal+=', <span class="publary-format-volissno">'+lang.number+"&nbsp;"+pub.number+"</span>"),"pages"in pub){var pages=pub.pages;journal+=(pages=', <span class="publary-format-pages">'+("number"==typeof pages||-1==pages.indexOf("-")?lang["p."]+"&nbsp;"+pages:lang["pp."]+"&nbsp;"+pages)+"</span>").replace("--","-")}"publisher"in pub&&(journal+=', <span class="publary-format-address">'+pub.publisher+"</span>"),"address"in pub&&(journal+=', <span class="publary-format-address">'+pub.address+"</span>"),journal+=', <span class="publary-format-date">'+("month"in pub?lang.months[pub.month-1]+"&nbsp;":"")+year+"</span>","isbn"in pub&&(journal+=', <span class="publary-format-isbn">ISBN&nbsp;'+pub.isbn+"</span>"),"issn"in pub&&(journal+=', <span class="publary-format-issn">ISSN&nbsp;'+pub.issn+"</span>"),"doi"in pub&&(journal+=', <span class="publary-format-doi">DOI&nbsp;<a href="https://doi.org/'+pub.doi+'">'+pub.doi+"</a></span> "),"urn"in pub&&(journal+=', <span class="publary-format-urn">URN&nbsp;<a href="http://nbn-resolving.de/'+pub.urn+'">'+pub.urn+"</span> ")}"pdfpath"in pub&&(links+='<a href="'+encodeURL("publary\\"+pub.pdfpath)+'" target="_blank" data-rel="none"><i class="far fa-file-pdf"></i> '+lang.viewFulltextAsPdf+"</a> "),"url"in pub&&(links+='<a href="'+pub.url+'" target="_blank" data-rel="none"><i class="fas fa-external-link-alt"></i> Link</a> '),links+='<a href="'+encodeURL("publary\\"+pub.bibpath)+'" download target="_blank" data-rel="none"><i class="far fa-comment-alt"></i> '+lang.downloadBib+"</a> ","keywords"in pub&&pub.keywords.forEach(function(keyword){keywords+='<span class="keyword">'+keyword+"</span> "}),html='<div class="publary-item-type'+briefItem+'">'+type+'</div><div class="publary-item-title"><a class="collapsed" data-toggle="collapse"'+(href=""==abstract&&""==keywords?"":' href="#'+key+'"')+">"+title+'</a></div><div class="publary-item-authors">'+authors+'</div><div class="publary-item-journal'+briefItem+'">'+journal+'</div><div class="publary-item-links">'+links+'</div><div id="'+key+'" class="collapse publary-item-abstract">'+(""!=abstract?"<strong>"+lang.abstract+"</strong><div>"+abstract+"</div>":"")+(""!=keywords?"<strong>"+lang.keywords+"</strong><div>"+keywords+"</div>":"")+"</div>";var item=document.createElement("li");item.classList.add("publary-item"),item.innerHTML=html,publaryList.appendChild(item)}var publaryQuery=document.querySelector("#publary-filter-query"),publaryList=document.querySelector("#publary-list"),lang=LANGUAGE_URL_SELECTOR_EN.test(location.href.replace(location.hash,""))?TRANSLATION.en:TRANSLATION.de,inputTimeout=null,query;$(document).ready(function(){$(".switch-list .brief-list i").after("&nbsp; "+lang.switchToBriefList),$(".switch-list .full-list i").after("&nbsp; "+lang.switchToFullList),$(".switch-list").click(function(){$(".switch-list .brief-list").toggleClass("d-none"),$(".switch-list .full-list").toggleClass("d-none"),publaryRefreshList()}),$(".nav-tabs a:not(.dropdown-toggle):not(.switch-list)").click(function(){var value=$(this).attr("href").substr(1);if($(this).hasClass("dropdown-item")){var tabs=$(".nav-tabs a.nav-link:not(.dropdown-toggle)");tabs.removeClass("active").attr("aria-selected","false"),tabs.last().attr("href","#"+value).html($(this).html()).addClass("active").attr("aria-selected","true"),$(".dropdown li").removeClass("active"),$(".dropdown-item").attr("aria-selected","false"),console.log(tabs)}history.pushState?history.pushState(null,null,$(this).attr("href")):location.hash=$(this).attr("href"),$(publaryQuery).val(""),query="diss"==value?"?entry=diss":"?query="+value+"&entry=year",publaryRefreshList()}),$(publaryQuery).keyup(function(e){console.log(publaryQuery.value.length+": "+publaryQuery.value),null!=inputTimeout&&clearTimeout(inputTimeout),(13==e.which&&publaryQuery.value.length>=4||publaryQuery.value.length>4)&&(inputTimeout=setTimeout(function(){inputTimeout=null,query="?query="+publaryQuery.value,publaryRefreshList(),$(".nav-tabs a.nav-link:not(.dropdown-toggle)").removeClass("active")},13==e.which?0:500))});var hash="#"+location.hash.replace("#",""),def=!0;$(".nav-tabs a:not(.dropdown-toggle):not(.switch-list)").each(function(){$(this).attr("href")==hash&&(def=!1,$(this).click())}),def&&$(".nav-tabs a:not(.dropdown-toggle)").first().click()});